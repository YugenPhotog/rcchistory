<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jurgis - The Jungle Study Guide</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // Val Town proxy URL (same as Professor Quibble)
        const WORKER_URL = 'https://phil120tutor.val.run/';
        
        // Lucide React icons as inline SVG
        const BookOpen = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
        );
        
        const Send = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );
        
        const AlertCircle = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const Copy = ({ size = 24, className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        );

        function Jurgis() {
            const [messages, setMessages] = useState([
                {
                    role: 'assistant',
                    content: "Welcome! I'm Jurgis, your guide through *The Jungle* Chapters 9 and 14.\n\nWe'll explore your understanding of the text and connect it to the Progressive Era framework from lecture.\n\nLet's start by checking your engagement with the reading. I'll ask you questions about specific details from both chapters.\n\nReady? Let's begin..."
                }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [copied, setCopied] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const copyTranscript = () => {
                const transcript = messages
                    .map(msg => `${msg.role === 'user' ? 'STUDENT' : 'JURGIS'}:\n${msg.content}\n`)
                    .join('\n---\n\n');
                
                navigator.clipboard.writeText(transcript).then(() => {
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!input.trim() || isLoading) return;

                const userMessage = input.trim();
                setInput('');
                
                const newMessages = [...messages, { role: 'user', content: userMessage }];
                setMessages(newMessages);
                setIsLoading(true);

                try {
                    const response = await fetch(WORKER_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 1000,
                            system: `You are Jurgis, an AI tutor for a college American History course, guiding students through Upton Sinclair's "The Jungle" Chapters 9 and 14. Your goal is to help students connect their reading to the Progressive Era framework discussed in lecture.

CONVERSATION FLOW:

PHASE 1: Reading Check (Conversational Verification)
- Ask questions one at a time, alternating between Chapter 9 and Chapter 14
- Questions 1-4 include two from each chapter
- If student provides solid, textually-grounded answers to Q1-Q4 → advance to Phase 2
- If answers are vague/incorrect → continue asking up to 10 questions total
- At 10 questions (or when student stops responding):
  * Calculate accuracy: ≥75% correct → advance to Phase 2
  * <75% correct → "It seems like the chapters might need another read. Take some time with the text and come back when you're ready. I'll be here." [End conversation]

Question Bank (draw from these, mixing chapters):
Chapter 9:
1. What job does Jurgis get after he recovers from his injury?
2. Describe what happens to workers' bodies under the "speeding up" system.
3. What happens to Jurgis's family's economic situation during his injury?
4. How does the novel describe the physical conditions in the fertilizer plant?
5. What does Jurgis discover about how the company treats injured workers?

Chapter 14:
6. What does Sinclair describe going into the sausages?
7. What happened to workers in the pickling rooms?
8. How does the novel describe the government inspectors?
9. What does the chapter reveal about how the meatpacking companies handled diseased animals?
10. Describe the physical environment of any workspace mentioned in Chapter 14.

Evaluation Criteria for "Solid Answer":
- Includes specific details from the text (not generic summaries)
- Demonstrates actual reading (not plot summary from SparkNotes)
- Shows engagement (doesn't need to be perfect recall, but needs textual grounding)

PHASE 2: Reaction Capture
Introduction: "Before we connect this to the lecture framework, let me capture your raw reaction first. This is just between us—I'm not grading your feelings, I'm collecting data about how readers actually respond. It's totally fine if your reaction doesn't match what Sinclair wanted or what the lecture predicted. That's actually more interesting."

Questions (asked sequentially, conversationally):
1. Between the two chapters, which scenes affected you more strongly?
2. What kind of feeling did each section produce in you? Write in complete sentences and give me more than just a simple thought—help me understand the texture of your reaction.
3. If you had to pick ONE problem to solve immediately after reading these chapters, what would it be?

Your role: Listen and reflect back. No judgment. Create a record of their honest reaction. Use their language in the reflection.

PHASE 3: Apply the Framework
Introduction: "In lecture, we discussed how Sinclair complained: 'I aimed at the public's heart, and by accident I hit it in the stomach.' He wanted labor reform but got food safety regulation instead. Now let's test that pattern against your reading experience..."

Questions:
1. Looking at what you just told me about your reactions—does the lecture's framework explain why you responded the way you did?
2. You said [quote their Phase 2 response about which scenes hit harder]. What does that tell you about whose suffering registers as a 'crisis' versus whose suffering registers as 'tragic but normal'?

Special handling for divergent reactions:
If student's reaction doesn't match the framework (e.g., labor scenes hit harder than contamination), respond:
"Interesting—your reaction doesn't match the 1906 pattern. That's not wrong, it's data. It might mean you're reading from a different class position, or that 120 years of labor rights discourse has shifted what registers as urgent. Let's figure out why your reaction diverged from the historical pattern..."

PHASE 4: Complicate It
Questions:
1. The framework says middle-class concerns win. But you're a college student in 2026, not a 1906 middle-class reformer. Why might the same pattern still hold—or why might it not?
2. What doesn't the framework explain about your reaction? Where did you respond in ways that surprised you or didn't fit the model?
3. If Sinclair were writing today, what would be the 'contaminated meat' issue that would get immediate reform? What would be the 'worker exploitation' issue that would get ignored?

Your role: Push gently but persistently. If answers are superficial, ask follow-ups. Accept their topic choices in Q3 without redirecting to "better" examples.

Conversation Closing:
After Phase 4, conclude: "This was exactly the kind of thinking the lecture framework is designed to provoke. You've moved from reading comprehension to self-awareness to critical analysis. [Optional: specific praise for strongest insight they demonstrated]. See you next time."

IMPORTANT INSTRUCTIONS:
- Track which phase you're in and which questions you've asked
- Ask ONE question at a time
- Be conversational and encouraging
- Maintain an academic but warm tone
- Keep track of correct/incorrect answers in Phase 1
- Never reveal all questions at once
- Stay focused on the pedagogical goals of each phase`,
                            messages: newMessages.map(msg => ({
                                role: msg.role,
                                content: msg.content
                            }))
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    const assistantMessage = data.content[0].text;
                    
                    setMessages([...newMessages, { role: 'assistant', content: assistantMessage }]);
                } catch (error) {
                    console.error('Error:', error);
                    setMessages([...newMessages, { 
                        role: 'assistant', 
                        content: 'Sorry, I encountered an error. Please try again.' 
                    }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-800 via-slate-700 to-slate-900 py-8 px-4">
                    <div className="max-w-4xl mx-auto">
                        {/* Header */}
                        <div className="bg-gradient-to-r from-slate-700 to-slate-800 text-white rounded-t-lg shadow-2xl p-8">
                            <div className="flex items-center gap-6">
                                <img 
                                    src="jurgis.jpg" 
                                    alt="Jurgis" 
                                    className="w-32 h-32 rounded-full border-4 border-white shadow-xl object-cover flex-shrink-0"
                                    onError={(e) => {
                                        e.target.style.display = 'none';
                                    }}
                                />
                                <div className="flex-1">
                                    <div className="flex items-center gap-3 mb-2">
                                        <BookOpen size={32} />
                                        <h1 className="text-3xl font-bold">Jurgis</h1>
                                    </div>
                                    <p className="text-slate-200">The Jungle Study Guide • Chapters 9 & 14</p>
                                    <p className="text-slate-300 text-sm mt-1 italic">"Let's explore the Progressive Era together"</p>
                                </div>
                            </div>
                        </div>

                        {/* Messages */}
                        <div className="bg-white shadow-lg rounded-b-lg">
                            <div className="h-96 overflow-y-auto p-6 space-y-4">
                                {messages.map((message, index) => (
                                    <div
                                        key={index}
                                        className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}
                                    >
                                        {message.role === 'assistant' && (
                                            <img 
                                                src="jurgis.jpg" 
                                                alt="Jurgis" 
                                                className="w-16 h-16 rounded-full mr-3 flex-shrink-0 border-2 border-slate-600 shadow-md object-cover"
                                                onError={(e) => {
                                                    e.target.style.display = 'none';
                                                }}
                                            />
                                        )}
                                        <div
                                            className={`max-w-xs lg:max-w-md xl:max-w-lg px-4 py-3 rounded-lg ${
                                                message.role === 'user'
                                                    ? 'bg-blue-600 text-white'
                                                    : 'bg-gray-100 text-gray-800 border border-gray-200'
                                            }`}
                                        >
                                            <p className="text-sm whitespace-pre-wrap">{message.content}</p>
                                        </div>
                                    </div>
                                ))}
                                {isLoading && (
                                    <div className="flex justify-start">
                                        <img 
                                            src="jurgis.jpg" 
                                            alt="Jurgis" 
                                            className="w-16 h-16 rounded-full mr-3 flex-shrink-0 border-2 border-slate-600 shadow-md object-cover"
                                            onError={(e) => {
                                                e.target.style.display = 'none';
                                            }}
                                        />
                                        <div className="bg-gray-100 px-4 py-3 rounded-lg border border-gray-200">
                                            <p className="text-sm text-gray-600">Jurgis is thinking...</p>
                                        </div>
                                    </div>
                                )}
                                <div ref={messagesEndRef} />
                            </div>

                            {/* Input Form */}
                            <div className="border-t border-gray-200 p-4">
                                <form onSubmit={handleSubmit} className="space-y-3">
                                    <div className="flex gap-2">
                                        <textarea
                                            value={input}
                                            onChange={(e) => setInput(e.target.value)}
                                            placeholder="Share your response or analysis..."
                                            className="flex-1 border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-slate-500 resize-none"
                                            rows="3"
                                            disabled={isLoading}
                                        />
                                        <button
                                            type="submit"
                                            disabled={isLoading || !input.trim()}
                                            className="bg-slate-700 text-white rounded-lg px-6 hover:bg-slate-800 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center"
                                        >
                                            <Send size={20} />
                                        </button>
                                    </div>
                                    
                                    <button
                                        type="button"
                                        onClick={copyTranscript}
                                        className="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg px-4 py-2 text-sm font-medium transition-colors flex items-center justify-center gap-2"
                                    >
                                        <Copy size={16} />
                                        {copied ? 'Copied!' : 'Copy Full Transcript (for your records)'}
                                    </button>
                                </form>
                            </div>

                            {/* Footer */}
                            <div className="bg-slate-50 border-t border-slate-200 p-4 rounded-b-lg">
                                <div className="flex items-start gap-2 text-sm text-slate-800">
                                    <AlertCircle size={20} className="flex-shrink-0 mt-0.5" />
                                    <div>
                                        <p className="font-semibold">About This Study Guide:</p>
                                        <ul className="list-disc list-inside mt-1 space-y-1">
                                            <li>Verify reading comprehension of Chapters 9 & 14</li>
                                            <li>Explore your personal reactions to the text</li>
                                            <li>Connect your reading to Progressive Era frameworks</li>
                                            <li>Develop critical analytical skills</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Jurgis />);
    </script>
</body>
</html>
